-- Provider selection test
-- This test verifies that all embedding providers can be configured
-- Test provider configuration defaults
SHOW pgedge_vectorizer.provider;
 pgedge_vectorizer.provider 
----------------------------
 openai
(1 row)

-- Test available providers are registered (all should work)
DO $$
BEGIN
    -- All providers should be available (we can't test actual API calls without keys)
    -- But we can verify they're registered in the system
    RAISE NOTICE 'Provider configuration test completed';
END;
$$;
NOTICE:  Provider configuration test completed
-- Test OpenAI provider configuration
SET pgedge_vectorizer.provider = 'openai';
ERROR:  parameter "pgedge_vectorizer.provider" cannot be changed now
SET pgedge_vectorizer.api_url = 'https://api.openai.com/v1';
ERROR:  parameter "pgedge_vectorizer.api_url" cannot be changed now
SET pgedge_vectorizer.model = 'text-embedding-3-small';
ERROR:  parameter "pgedge_vectorizer.model" cannot be changed now
SHOW pgedge_vectorizer.provider;
 pgedge_vectorizer.provider 
----------------------------
 openai
(1 row)

SHOW pgedge_vectorizer.api_url;
 pgedge_vectorizer.api_url 
---------------------------
 https://api.openai.com/v1
(1 row)

SHOW pgedge_vectorizer.model;
 pgedge_vectorizer.model 
-------------------------
 text-embedding-3-small
(1 row)

-- Test Voyage AI provider configuration
SET pgedge_vectorizer.provider = 'voyage';
ERROR:  parameter "pgedge_vectorizer.provider" cannot be changed now
SET pgedge_vectorizer.api_url = 'https://api.voyageai.com/v1';
ERROR:  parameter "pgedge_vectorizer.api_url" cannot be changed now
SET pgedge_vectorizer.model = 'voyage-2';
ERROR:  parameter "pgedge_vectorizer.model" cannot be changed now
SHOW pgedge_vectorizer.provider;
 pgedge_vectorizer.provider 
----------------------------
 openai
(1 row)

SHOW pgedge_vectorizer.api_url;
 pgedge_vectorizer.api_url 
---------------------------
 https://api.openai.com/v1
(1 row)

SHOW pgedge_vectorizer.model;
 pgedge_vectorizer.model 
-------------------------
 text-embedding-3-small
(1 row)

-- Test Ollama provider configuration
SET pgedge_vectorizer.provider = 'ollama';
ERROR:  parameter "pgedge_vectorizer.provider" cannot be changed now
SET pgedge_vectorizer.api_url = 'http://localhost:11434';
ERROR:  parameter "pgedge_vectorizer.api_url" cannot be changed now
SET pgedge_vectorizer.model = 'nomic-embed-text';
ERROR:  parameter "pgedge_vectorizer.model" cannot be changed now
SHOW pgedge_vectorizer.provider;
 pgedge_vectorizer.provider 
----------------------------
 openai
(1 row)

SHOW pgedge_vectorizer.api_url;
 pgedge_vectorizer.api_url 
---------------------------
 https://api.openai.com/v1
(1 row)

SHOW pgedge_vectorizer.model;
 pgedge_vectorizer.model 
-------------------------
 text-embedding-3-small
(1 row)

-- Reset to defaults
RESET pgedge_vectorizer.provider;
ERROR:  parameter "pgedge_vectorizer.provider" cannot be changed now
RESET pgedge_vectorizer.api_url;
ERROR:  parameter "pgedge_vectorizer.api_url" cannot be changed now
RESET pgedge_vectorizer.model;
ERROR:  parameter "pgedge_vectorizer.model" cannot be changed now
SHOW pgedge_vectorizer.provider;
 pgedge_vectorizer.provider 
----------------------------
 openai
(1 row)

